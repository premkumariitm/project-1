<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#051a14">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>JEE Universe</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="metadata.json">
    
    <!-- Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #051a14;
            color: #f8fafc;
            overscroll-behavior-y: contain;
            -webkit-tap-highlight-color: transparent;
        }
        .font-game {
            font-family: 'Orbitron', sans-serif;
        }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #051a14; }
        ::-webkit-scrollbar-thumb { background: #064e3b; border-radius: 10px; }
        .select-none { -webkit-user-select: none; user-select: none; }
        
        /* 3D Button Effect */
        .btn-3d-emerald {
            background: #064e3b;
            box-shadow: 0 4px 0 #022c22;
            transition: all 0.1s ease;
            position: relative;
            top: 0;
        }
        .btn-3d-emerald:hover {
            background: #065f46;
            transform: translateY(-1px);
            box-shadow: 0 5px 0 #022c22;
        }
        .btn-3d-emerald:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #022c22;
        }

        /* Transition utility */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            background-color: rgba(5, 26, 20, 0.98);
            backdrop-filter: blur(8px);
        }

        .subject-icon-img {
            width: 70%;
            height: 70%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.7));
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client"
      }
    }
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';

        // --- CONSTANTS ---
        
        const POINTS_PER_XP = 5;
        const XP_PER_LEVEL = 10;
        const POINTS_PER_LEVEL = POINTS_PER_XP * XP_PER_LEVEL; // 50 points = 1 Level
        const STREAK_THRESHOLD = 30; // 30 points scored today for streak

        const SUBJECT_CONFIG = {
            Physics: { icon: 'physics.png' },
            Chemistry: { icon: 'chemistry.png' },
            Mathematics: { icon: 'maths.png' }
        };

        const POINT_SCHEME = {
            Physics: {
                MAINS: { EASY: 5, MEDIUM: 10, HARD: 15 },
                ADVANCE: { EASY: 10, MEDIUM: 20, HARD: 30 }
            },
            Chemistry: {
                MAINS: { EASY: 5, MEDIUM: 15, HARD: 25 },
                ADVANCE: { EASY: 10, MEDIUM: 30, HARD: 50 }
            },
            Mathematics: {
                MAINS: { EASY: 5, MEDIUM: 10, HARD: 20 },
                ADVANCE: { EASY: 10, MEDIUM: 20, HARD: 40 }
            }
        };

        // --- SHARED COMPONENTS ---

        const LevelCard = ({ level, segmentsFilled, label = "Level" }) => (
            <div className="bg-[#06241c] border border-emerald-900/50 rounded-2xl p-6 md:p-8 h-full flex flex-col justify-center overflow-hidden w-full">
                <div className="flex items-center gap-4 mb-4 md:mb-6">
                    <span className="font-game text-sm md:text-3xl font-bold text-emerald-100/70 uppercase tracking-widest">{label}</span>
                    <div className="inline-flex items-center justify-center border border-emerald-500/50 px-5 py-2 rounded-[4px] bg-emerald-950/50">
                        <span className="font-game text-emerald-400 font-bold text-2xl md:text-6xl leading-none">{level}</span>
                    </div>
                </div>
                <div className="relative w-full">
                    <div className="h-[16px] md:h-[30px] w-full bg-emerald-950/80 border border-emerald-900/30 rounded-full overflow-hidden flex gap-[2px] p-[2px]">
                        {[...Array(10)].map((_, i) => (
                            <div key={i} className={`flex-1 h-full first:rounded-l-full last:rounded-r-full ${i < segmentsFilled ? 'bg-emerald-500' : 'bg-emerald-900/20'}`} />
                        ))}
                    </div>
                    <div className="flex justify-between mt-3 md:mt-5 px-1">
                        <span className="text-xs md:text-2xl text-emerald-800 font-bold uppercase tracking-wider">XP PROGRESS</span>
                        <span className="text-xs md:text-2xl text-emerald-500/80 font-bold uppercase tracking-wider">{segmentsFilled * 10}%</span>
                    </div>
                </div>
            </div>
        );

        const StreakCard = ({ streak = 0, label = "Streak" }) => (
            <div className="bg-[#06241c] border border-orange-500/20 rounded-2xl p-4 md:p-6 h-full flex flex-col items-center justify-center text-center relative overflow-hidden group hover:border-orange-500/50 transition-all">
                <span className="text-5xl md:text-8xl mb-2">üî•</span>
                <div className="text-orange-500 font-game text-xl md:text-5xl font-bold leading-none">{streak} DAYS</div>
                <div className="text-emerald-100/50 font-semibold uppercase tracking-widest mt-2 text-[10px] md:text-xl">{label}</div>
            </div>
        );

        const PointsCard = ({ points, label = "Points" }) => (
            <div className="bg-[#06241c] border border-yellow-500/20 rounded-2xl p-4 md:p-6 h-full flex flex-col items-center justify-center text-center relative overflow-hidden group hover:border-yellow-500/50 transition-all">
                <span className="text-5xl md:text-8xl mb-2">‚ö°</span>
                <div className="text-yellow-500 font-game text-xl md:text-5xl font-bold leading-none">{points.toLocaleString()}</div>
                <div className="text-emerald-100/50 font-semibold uppercase tracking-widest mt-2 text-[10px] md:text-xl">{label}</div>
            </div>
        );

        // --- POINT CONTROL MODAL ---

        const ActionModal = ({ isOpen, onClose, subject, examType, difficulty, initialPoints, onSave }) => {
            const [localPoints, setLocalPoints] = useState(0);

            useEffect(() => {
                if (isOpen) setLocalPoints(initialPoints);
            }, [isOpen, initialPoints]);

            if (!isOpen) return null;

            const incrementValue = POINT_SCHEME[subject]?.[examType]?.[difficulty] || 10;

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 modal-overlay fade-in" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="bg-[#06241c] border border-emerald-500/40 rounded-3xl p-10 md:p-14 w-full max-w-2xl space-y-12 md:space-y-16 relative shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex items-center justify-between pb-10 border-b border-emerald-900/30">
                            <button onClick={onClose} className="bg-red-950/20 hover:bg-red-900/30 text-red-400 border border-red-900/40 w-20 h-20 flex items-center justify-center rounded-2xl font-game text-5xl transition-all active:scale-95">√ó</button>
                            <button onClick={() => setLocalPoints(0)} className="bg-slate-800/40 hover:bg-slate-800/60 text-slate-300 border border-slate-700/50 px-10 py-5 rounded-2xl font-game text-sm md:text-3xl tracking-widest transition-all active:scale-95 uppercase">RESET</button>
                        </div>
                        <div className="text-center space-y-4">
                            <h2 className="font-game text-2xl md:text-5xl text-emerald-400 font-bold tracking-[0.3em] uppercase">{subject}</h2>
                            <p className="text-sm md:text-3xl text-emerald-600 font-bold tracking-[0.2em] uppercase">{examType} ‚Ä¢ {difficulty}</p>
                        </div>
                        <div className="bg-emerald-950/80 border-2 border-emerald-500/30 rounded-3xl py-16 md:py-24 text-center relative overflow-hidden group">
                            <div className="text-yellow-500 font-game text-8xl md:text-[11rem] font-bold tracking-widest flex items-center justify-center gap-8">
                                <span className="text-6xl md:text-9xl">‚ö°</span>{localPoints}
                            </div>
                            <div className="text-emerald-500/40 font-bold text-lg md:text-3xl uppercase tracking-widest mt-10">Data Points Earned</div>
                        </div>
                        <div className="grid grid-cols-2 gap-10">
                            <button onClick={() => setLocalPoints(p => p + incrementValue)} className="btn-3d-emerald rounded-3xl py-12 md:py-20 flex flex-col items-center justify-center active:scale-95 transition-transform">
                                <span className="text-7xl md:text-[10rem] text-emerald-100 mb-4">+</span>
                                <span className="text-xs md:text-3xl font-game text-emerald-500/80 font-bold uppercase tracking-widest">ADD {incrementValue}</span>
                            </button>
                            <button onClick={() => setLocalPoints(p => Math.max(0, p - incrementValue))} className="btn-3d-emerald rounded-3xl py-12 md:py-20 flex flex-col items-center justify-center active:scale-95 transition-transform">
                                <span className="text-7xl md:text-[10rem] text-emerald-100 mb-4">‚àí</span>
                                <span className="text-xs md:text-3xl font-game text-emerald-500/80 font-bold uppercase tracking-widest">SUB {incrementValue}</span>
                            </button>
                        </div>
                        <button onClick={() => onSave(localPoints)} className="btn-3d-emerald w-full rounded-3xl py-8 md:py-12 flex items-center justify-center active:scale-95 transition-transform group">
                            <span className="font-game text-xl md:text-5xl text-emerald-100 font-bold uppercase tracking-[0.4em] group-hover:tracking-[0.5em] transition-all">SAVE CHANGES</span>
                        </button>
                    </div>
                </div>
            );
        };

        // --- WORLD COMPONENTS ---

        const SubBlockButton = ({ title, onClick }) => (
            <button onClick={onClick} className="btn-3d-emerald w-full py-8 md:py-16 rounded-2xl flex items-center justify-center border border-emerald-500/10 active:scale-95 transition-transform">
                <span className="font-game text-sm md:text-4xl text-emerald-100/90 uppercase tracking-[0.25em] font-bold leading-none">{title}</span>
            </button>
        );

        const ColumnBlock = ({ title, children }) => (
            <div className="bg-[#06241c] border border-emerald-900/50 rounded-2xl p-10 md:p-14 flex flex-col gap-10 md:gap-14 h-full w-full">
                <div className="border-b border-emerald-900/30 pb-8 md:pb-12 text-center">
                    <h3 className="font-game text-sm md:text-5xl text-emerald-400 font-bold uppercase tracking-[0.4em]">{title}</h3>
                </div>
                <div className="flex flex-col gap-8 md:gap-12">{children}</div>
            </div>
        );

        const WorldDashboard = ({ onAction }) => (
            <div className="flex flex-row gap-10 md:gap-20 items-stretch w-full pb-24">
                <div className="flex-1">
                    <ColumnBlock title="MAINS">
                        <SubBlockButton title="EASY" onClick={() => onAction('MAINS', 'EASY')} />
                        <SubBlockButton title="MEDIUM" onClick={() => onAction('MAINS', 'MEDIUM')} />
                        <SubBlockButton title="HARD" onClick={() => onAction('MAINS', 'HARD')} />
                    </ColumnBlock>
                </div>
                <div className="flex-1">
                    <ColumnBlock title="ADVANCE">
                        <SubBlockButton title="EASY" onClick={() => onAction('ADVANCE', 'EASY')} />
                        <SubBlockButton title="MEDIUM" onClick={() => onAction('ADVANCE', 'MEDIUM')} />
                        <SubBlockButton title="HARD" onClick={() => onAction('ADVANCE', 'HARD')} />
                    </ColumnBlock>
                </div>
            </div>
        );

        // --- VIEWS ---

        const DashboardView = ({ globalStats, onEnterWorld }) => {
            const badges = [
                { id: 1, icon: 'üåü', label: 'Apprentice', active: globalStats.level >= 1 },
                { id: 2, icon: '‚öîÔ∏è', label: 'Master', active: globalStats.level >= 5 },
                { id: 3, icon: 'üèÜ', label: 'Grandmaster', active: globalStats.points >= 2000 },
                { id: 4, icon: 'üî•', label: 'Consistent', active: globalStats.streak >= 7 },
            ];

            return (
                <div className="fade-in space-y-12 md:space-y-20 pb-24">
                    <header className="bg-emerald-950/20 border border-emerald-900/50 rounded-2xl p-14 md:p-24 text-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-emerald-500/20"></div>
                        <h1 className="text-6xl md:text-[11rem] font-game font-bold text-emerald-400 tracking-tight text-center uppercase">JEE UNIVERSE</h1>
                        <div className="flex items-center justify-center gap-10 mt-8">
                            <div className="h-px w-20 bg-emerald-900"></div>
                            <p className="text-emerald-500/50 font-medium tracking-[0.4em] uppercase text-sm md:text-5xl">Preparation Odyssey</p>
                            <div className="h-px w-20 bg-emerald-900"></div>
                        </div>
                    </header>

                    <section className="grid grid-cols-4 gap-8 md:gap-14 h-40 md:h-72">
                        <div className="col-span-2 h-full">
                            <LevelCard level={globalStats.level} segmentsFilled={globalStats.segments} />
                        </div>
                        <div className="col-span-1 h-full">
                            <StreakCard streak={globalStats.streak} />
                        </div>
                        <div className="col-span-1 h-full">
                            <PointsCard points={globalStats.points} label="Total Points" />
                        </div>
                    </section>

                    <section className="bg-emerald-950/20 border border-emerald-800/40 rounded-[5rem] p-12 md:p-24 space-y-16 md:space-y-32 relative overflow-hidden shadow-2xl">
                        <div className="flex justify-center">
                            <div className="bg-[#06241c] border border-emerald-500/30 rounded-3xl px-20 md:px-48 py-8 md:py-16">
                                <h2 className="text-emerald-400 font-game text-3xl md:text-[6rem] font-bold uppercase tracking-[0.5em]">Worlds</h2>
                            </div>
                        </div>
                        <div className="grid grid-cols-3 gap-10 md:gap-24">
                            {['Physics', 'Chemistry', 'Mathematics'].map((subject) => (
                                <button key={subject} onClick={() => onEnterWorld(subject)} className="btn-3d-emerald rounded-[2rem] md:rounded-[5rem] p-10 md:p-24 flex flex-col items-center justify-center gap-10 md:gap-20 group touch-manipulation">
                                    <div className="w-24 h-24 md:w-56 md:h-56 rounded-full bg-emerald-950/50 flex items-center justify-center border border-emerald-500/20 group-hover:border-emerald-500 transition-all duration-300 shadow-xl overflow-hidden p-6">
                                        <img src={SUBJECT_CONFIG[subject].icon} className="subject-icon-img" alt={subject} />
                                    </div>
                                    <span className="font-game text-sm md:text-[3.5rem] text-emerald-50/90 font-bold uppercase tracking-[0.2em] md:tracking-[0.3em] text-center leading-tight">{subject}</span>
                                </button>
                            ))}
                        </div>
                    </section>
                    
                    <section className="bg-[#06241c] border border-emerald-900/30 rounded-[3rem] p-12 md:p-24 space-y-16 shadow-inner">
                        <div className="flex items-center gap-10 mb-8">
                            <div className="h-px flex-grow bg-emerald-900/30"></div>
                            <h3 className="font-game text-sm md:text-[4.5rem] text-emerald-700 font-bold uppercase tracking-[0.5em]">Badges</h3>
                            <div className="h-px flex-grow bg-emerald-900/30"></div>
                        </div>
                        <div className="grid grid-cols-4 gap-8 md:gap-16">
                            {badges.map(badge => (
                                <div key={badge.id} className={`bg-emerald-950/20 border ${badge.active ? 'border-emerald-500/30 shadow-[0_0_20px_rgba(16,185,129,0.2)]' : 'border-emerald-900/10 opacity-20 grayscale'} rounded-3xl p-10 md:p-24 flex flex-col items-center justify-center text-center transition-all`}>
                                    <span className="text-6xl md:text-[11rem] mb-8 md:mb-16">{badge.icon}</span>
                                    <span className="font-game text-[10px] md:text-[2.5rem] text-emerald-100/60 font-bold uppercase tracking-[0.2em]">{badge.label}</span>
                                </div>
                            ))}
                        </div>
                    </section>
                </div>
            );
        };

        const WorldView = ({ subject, onBack, subjectData, onUpdatePoint }) => {
            const [modalConfig, setModalConfig] = useState({ isOpen: false, examType: '', difficulty: '' });

            return (
                <div className="fade-in space-y-12 md:space-y-24">
                    <header className="bg-emerald-950/20 border border-emerald-900/50 rounded-2xl p-10 md:p-16 flex items-center justify-between gap-10 sticky top-4 z-40 backdrop-blur-md shadow-lg">
                        <button onClick={onBack} className="bg-[#06241c] border border-emerald-500/30 px-10 md:px-20 py-5 md:py-10 rounded-2xl font-game text-sm md:text-[2.5rem] text-emerald-400 uppercase tracking-widest hover:bg-emerald-900/40 transition-all active:scale-95">‚Üê Back</button>
                        <div className="flex items-center gap-8 md:gap-14">
                            <div className="w-16 h-16 md:w-32 md:h-32 bg-emerald-900/40 rounded-full flex items-center justify-center p-2">
                                <img src={SUBJECT_CONFIG[subject].icon} className="subject-icon-img" alt={subject} />
                            </div>
                            <h1 className="text-2xl md:text-[5rem] font-game font-bold text-emerald-400 tracking-tight uppercase">{subject}</h1>
                        </div>
                        <div className="hidden md:block md:w-[200px]"></div>
                    </header>

                    <section className="grid grid-cols-4 gap-8 md:gap-14 h-40 md:h-72">
                        <div className="col-span-3 h-full">
                            <LevelCard level={subjectData.level} segmentsFilled={subjectData.segments} label="Subject Lvl" />
                        </div>
                        <div className="col-span-1 h-full">
                            <PointsCard points={subjectData.totalPoints} label="Sub Pts" />
                        </div>
                    </section>

                    <WorldDashboard onAction={(type, diff) => setModalConfig({ isOpen: true, examType: type, difficulty: diff })} />

                    <ActionModal 
                        isOpen={modalConfig.isOpen}
                        onClose={() => setModalConfig({ ...modalConfig, isOpen: false })}
                        subject={subject}
                        examType={modalConfig.examType}
                        difficulty={modalConfig.difficulty}
                        initialPoints={modalConfig.examType ? subjectData.matrix[modalConfig.examType.toLowerCase()][modalConfig.difficulty.toLowerCase()] : 0}
                        onSave={(newPoints) => {
                            onUpdatePoint(subject, modalConfig.examType, modalConfig.difficulty, newPoints);
                            setModalConfig({ ...modalConfig, isOpen: false });
                        }}
                    />
                </div>
            );
        }

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [activeWorld, setActiveWorld] = useState(null);

            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('jee-universe-restored-v8');
                const today = new Date().toLocaleDateString('en-CA');
                const base = saved ? JSON.parse(saved) : {
                    Physics: { matrix: { mains: { easy: 0, medium: 0, hard: 0 }, advance: { easy: 0, medium: 0, hard: 0 } } },
                    Chemistry: { matrix: { mains: { easy: 0, medium: 0, hard: 0 }, advance: { easy: 0, medium: 0, hard: 0 } } },
                    Mathematics: { matrix: { mains: { easy: 0, medium: 0, hard: 0 }, advance: { easy: 0, medium: 0, hard: 0 } } },
                    baseStreak: 0,
                    pointsToday: 0,
                    lastVisitDate: today
                };
                return base;
            });

            useEffect(() => {
                const today = new Date().toLocaleDateString('en-CA');
                const yesterday = new Date(Date.now() - 86400000).toLocaleDateString('en-CA');

                setData(prev => {
                    if (prev.lastVisitDate === today) return prev;
                    let newBaseStreak = prev.baseStreak || 0;
                    if (prev.lastVisitDate === yesterday) {
                        if (prev.pointsToday >= STREAK_THRESHOLD) {
                            newBaseStreak += 1;
                        } else {
                            newBaseStreak = 0;
                        }
                    } else {
                        newBaseStreak = 0;
                    }
                    return { ...prev, baseStreak: newBaseStreak, pointsToday: 0, lastVisitDate: today };
                });
            }, []);

            useEffect(() => localStorage.setItem('jee-universe-restored-v8', JSON.stringify(data)), [data]);

            const stats = useMemo(() => {
                const subjects = ['Physics', 'Chemistry', 'Mathematics'];
                const subjectStats = {};
                let globalPoints = 0;

                subjects.forEach(sub => {
                    const m = data[sub].matrix;
                    const subPoints = Object.values(m.mains).reduce((a, b) => a + b, 0) + Object.values(m.advance).reduce((a, b) => a + b, 0);
                    globalPoints += subPoints;
                    const level = Math.floor(subPoints / POINTS_PER_LEVEL);
                    const segments = Math.floor((subPoints % POINTS_PER_LEVEL) / POINTS_PER_XP);
                    subjectStats[sub] = { totalPoints: subPoints, level, segments, matrix: data[sub].matrix };
                });

                const globalLevel = Math.floor(globalPoints / POINTS_PER_LEVEL);
                const globalSegments = Math.floor((globalPoints % POINTS_PER_LEVEL) / POINTS_PER_XP);
                const activeStreak = (data.baseStreak || 0) + (data.pointsToday >= STREAK_THRESHOLD ? 1 : 0);

                return { 
                    global: { 
                        points: globalPoints, 
                        level: globalLevel, 
                        segments: globalSegments, 
                        streak: activeStreak 
                    }, 
                    subjects: subjectStats 
                };
            }, [data]);

            const updatePoints = (subject, type, difficulty, newValue) => {
                setData(prev => {
                    const oldVal = prev[subject].matrix[type.toLowerCase()][difficulty.toLowerCase()];
                    const delta = newValue - oldVal;
                    return {
                        ...prev,
                        [subject]: { 
                            ...prev[subject], 
                            matrix: { 
                                ...prev[subject].matrix, 
                                [type.toLowerCase()]: { 
                                    ...prev[subject].matrix[type.toLowerCase()], 
                                    [difficulty.toLowerCase()]: newValue 
                                } 
                            } 
                        },
                        pointsToday: prev.pointsToday + delta
                    };
                });
            };

            return (
                <div className="min-h-screen bg-[#051a14] p-8 md:p-16 space-y-16 max-w-[140rem] mx-auto pb-40 select-none">
                    {view === 'dashboard' ? (
                        <DashboardView globalStats={stats.global} onEnterWorld={(w) => { setActiveWorld(w); setView('world'); window.scrollTo(0, 0); }} />
                    ) : (
                        <WorldView subject={activeWorld} onBack={() => setView('dashboard')} subjectData={stats.subjects[activeWorld]} onUpdatePoint={updatePoints} />
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>